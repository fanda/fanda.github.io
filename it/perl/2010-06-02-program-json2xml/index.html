<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<title>Program JSON2XML</title>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' type='text/javascript'></script>
<script>
  window.jQuery || document.write('<script src="/a/js/l/jquery.js">\x3C/script>')
</script>
<script src='http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js' type='text/javascript'></script>
<script>
  window.Modernizr || document.write('<script src="/a/js/l/modernizr.js">\x3C/script>')
</script>
<script src="/a/script/l/fastclick.js" type="text/javascript"></script>
<script src="/a/script/l/modernizr.js" type="text/javascript"></script>
<script src="/a/script/l/jquery.cookie.js" type="text/javascript"></script>
<script src="/a/script/l/placeholder.js" type="text/javascript"></script>
<script src="/a/script/l/fastclick.js" type="text/javascript"></script>
<script src="/a/script/l/foundation.custom.js" type="text/javascript"></script>
<script src="/a/script/script.js" type="text/javascript"></script>
<link href="/a/cs/app.css" media="screen" rel="stylesheet" type="text/css" />
</head>

<body class='it it_perl it_perl_2010-06-02-program-json2xml it_perl_2010-06-02-program-json2xml_index one-sidebar-right'>
<div id='container'>
<header id='header'>
<div id='sitename'>
<h1 class='wrapper'>
<a href='/'>Fanda Internetu</a>
</h1>
</div>
<div id='topmenu'>
<nav class='wrapper top-bar' data-options='is_hover: true' data-topbar>
<section class='top-bar-section'>
<ul class='title-area'>
<li class='name'></li>
</ul>
<ul>
<li><a href="/audio/">Audio</a></li>
<li class='divider'></li>
<li><a href="/internet/">Internet</a></li>
<li class='divider'></li>
<li class='has-dropdown'>
<a href="/it/">IT</a>
<ul class='dropdown'>
<li><a href="/it/cpp">C++</a></li>
<li><a href="/it/drupal">Drupal</a></li>
<li><a href="/it/iphone">iPhone</a></li>
<li><a href="/it/linux">Linux</a></li>
<li><a href="/it/perl">Perl</a></li>
<li><a href="/it/python">Python</a></li>
<li><a href="/it/ruby">Ruby</a></li>
<li><a href="/it/ostatní">Ostatní</a></li>
</ul>
</li>
<li class='divider'></li>
<li><a href="/knihy">Knihy</a></li>
<li class='divider'></li>
<li><a href="/matematika/">Matematika</a></li>
<li class='divider'></li>
<li class='has-dropdown'>
<a href="/odkazy/">Odkazy</a>
<ul class='dropdown'>
<li><a href="http://vystavuj.cz">Vystavuj</a></li>
<li><a href="http://lovcisnu.cz">Lovci snů</a></li>
<li><a title="Kryptoměny, Bitcoin, diskuze" href="http://satoshi.nakamoto.cz">Satoshi Nakamoto</a></li>
<li><a href="http://www.techsquat.com/">Techsquat</a></li>
</ul>
</li>
<li class='divider'></li>
<li>
<a href="/ostatní/">Ostatní</a>
</li>
<li class='divider'></li>
<li class='has-dropdown'>
<a href="/seberozvoj/">Seberozvoj</a>
<ul class='dropdown'>
<li><a href="/seberozvoj/joga">Jóga</a></li>
</ul>
</li>
<li class='divider'></li>
<li><a href="/video/">Video</a></li>
</ul>
</section>
</nav>
</div>
</header>

<section class='container row' id='center'>
<section class='large-9 columns' id='content'>
<div class='inn'><article style='display: block'>
<header>
<h1>
<small>
<time> 2.  6. 2010</time>
</small>
Program JSON2XML
</h1>

</header>
<p>Program JSON2XML v jazyce Perl vznikl jako školní projekt z předmětu Principy programovacích jazyků a OOP. Zde jeho zadání, popisný text k vypracované implementaci a implementace v jazyce Perl.</p>



<h1>Zadání</h1>
<p>Cílem je vytvořit skript pro konverzi JSON formátu do XML. Každému prvku z JSON formátu (objekt, pole, dvojice jméno-hodnota) bude odpovídat jeden párový element se jménem podle jména dvojice a obsahem podle hodnoty dvojice. Každé pole bude obaleno párovým elementem &lt;array&gt; a každý prvek pole bude obalen párovým elementem &lt;item&gt;.<br>
JSON hodnoty typu <strong>string</strong> a <strong>number</strong> a JSON literály <strong>true</strong>, <strong>false</strong> a <strong>null</strong> budou transformovány v závislosti na parametrech skriptu na atribut <strong>value</strong> daného elementu s odpovídající hodnotou nebo na textový element v případě hodnoty typu <strong>string</strong> a <strong>number</strong> či na element &lt;true&gt;, &lt;false&gt; a &lt;null&gt;.<br>
Verze formátu JSON, ač není standardizován ale je podmnožinou jazyka JavaScript, bude uvažována z webové stránky <a href="http://www.json.org" title="http://www.json.org">http://www.json.org</a> . Stručně: soubor obsahuje jeden globální objekt. <em>Objekty</em> jsou zapsány ve složených závorkách a obsahují čárkami oddělené dvojice <em>jméno</em> : <em>hodnota</em>. <em>Jméno</em> je řetězec jazyka JavaScript. <em>Pole</em> je zapsáno do hranatých závorek a obsahuje hodnoty oddělené čárkami. <em>Hodnota</em> může být další objekt, řetězec, číslo nebo pole. Hodnotou může být také literál <strong>true</strong>, <strong>false</strong> nebo <strong>null</strong>. Prázdné znaky mimo řetězce mohou být ignorovány.</p>
<h2>Parametry programu</h2>
<ul>
<li>
<strong>--help</strong>   nápověda programu</li>
<li>
<strong>--input=filename.ext</strong>   zadaný vstupní JSON soubor (pokud chybí, použije se standardní vstup)</li>
<li>
<strong>--output=filename.ext</strong>   textový výstupní XML soubory s obsahem převedeným ze vstupního souboru (pokud chybí, použije se standardní výstup)</li>
<li>
<strong>-n</strong>   negenerovat hlavičku XML na výstup skriptu</li>
<li>
<strong>-r=root-element</strong>   jméno párového kořenového elementu obalující výsledek. Pokud nebude zadán, tak se výsledek neobaluje kořenovým elementem, ač to potenciálně porušuje validitu XML.</li>
<li>
<strong>-s</strong>   hodnoty dvojic typu <strong>string</strong> budou transformovány na textové elementy místo na atributy</li>
<li>
<strong>-i</strong>   hodnoty dvojic typu <strong>number</strong> budou transformovány na textové elementy místo na atributy</li>
<li>
<strong>-l</strong>   hodnoty literálů (true, false, null) budou transformovány na elementy &lt;true&gt;, &lt;false&gt; a &lt;null&gt; místo na atributy</li>
<li>
<strong>-e</strong>   zotavení z chybějícího obalení pole kořenovým objektem tj. globální pole bude obaleno kořenovým objektem (nutno kombinovat s parametrem -r, jinak se přepne do chybového stavu)</li>
</ul>
<p><br></p>
<h1>Popis implementace programu</h1>
<p>Sic je jazyk Perl velmi mocný nástroj, oproti svému konkurentu jazyku Python má podstatně kostrbatější vyjadřovací prostředky, které ho předurčují pro potřeby spíše menších aplikací a skriptů, které implementují rychlé pomocné rutiny a textové filtry, ale jež by nebylo záhodno psát v jazycích podobného ražení jako například Bash. Samozřejmě jde taková tvrzení vyvrátit příklady větších a úspěšných aplikací. Je to čistě subjektivní názor, který jen předesílá důvody výběru této varianty.</p>
<p>Perl skrze CPAN nabízí velkou knihovnu modulů snadno rozšiřujících možnosti jazyka a šetřících programátorův čas. Při práci na aplikaci byly použity pouhé čtyři z nich a nyní vysvětlím důvody jejich použití a krátce popíši, jak se moduly pracovalo.</p>
<p>Data::Dumper je modul, který se aspoň na krátkou chvíli usadí v každé mé aplikaci, protože se jedná o skvělého pomocníka při ladění. Každou proměnou rozpitvá a ukáže ji tak, jak je. Přestože se většinou neohřeje déle než na implementační a ladící fáze, aplikace JSON2XML je v tomto výjimkou, neboť zde Data::Dumper skvěle pomáhá rozlišovat čísla a řetězce číslic. Jejich řádné nerozlišení se mi zdá jako malý nedostatek modulu JSON::XS.<br>
JSON::XS parsuje vstup aplikace, strukturu JSON jazyka Javascript. Díky tomuto modulu se práce se vstupem stala až překvapivě lehkou. Tak lehkou jako proložení argumentu funkce řetězcem. Funkce, která se jmenuje decode, ihned celý vstup uloží jako perlovský hash a ukáže na něj referencí.<br>
Výstup programu je pak uskutečněn pomocí modulu XML::Writer, který nabízí rozhraní k tvorbě XML dokumentů. Zápis XML je díky funkcím tohoto modulu velmi jednoduchý a přesto programátorům nechává volné ruce. Podporuje zapínání a vypínání kontroly výstupních souborů, což se hodí nejen při ladění programu.<br>
Posledním modulem je IO::File, ale o něm se rozepisovat nebudu, protože je použit jen kvůli závislosti, kterou na něm má modul XML::Writer.</p>
<p>Vskutku celý program sestává jen z použití těchto modulů. Část skriptu je vlastně jen iniciace objektů modulů, krátká práce s nimi a následný úklid. Přesto se v kódu aplikace vyskytují i čtyři podprogramy. Dva z nich pomáhají zpracovat vstup na výstup a dva se volají při zpracování argumentů z příkazové řádky. Naposled zmíněné popíši jako první.</p>
<p>Zpracování argumentů příkazové řádky provádí funkce parseOpts(). Ta všechny argumenty spojí do jednoho řetězce a zadané parametry vyhledává regulárními výrazy. Úspěšně vyhledaný regulární výraz je z řetězce odstraněn, takže na konci zbude řetězec složený jen z bílých znaků. Tak se pozná, byly-li vloženy jen správné argumenty a pokud jsou vloženy nevalidní agrumenty, program to pozná a skončí. Kvůli argumentu --help je vytvořen stejnojmený podprogram, který obsahuje textovou nápovědu.</p>
<p>Zbylé dva podprogramy jsou hlavní náplní aplikace. Jmenují se json2xml a value2xml. Podprogram json2xml je funkce, která je volána po inicializaci globálního objektu $writer, který používá pro tvorbu výsledného XML dokumentu. Ten je tvořen jednak rekurzívně tak, že jedno zanoření funkce odpovídá jednomu zanoření v perlovkém hashi a jednak iterativně, jelikož na jedné úrovní zanoření se může vyskytovat více objektů. Selektivně je pak odvozeno chování pro různé typy objektů, které se v hashi mohou vyskytovat. Jsou jimi pole, vnořené hashe a hodnoty. Právě pro hodnoty je vytvořen podprogram value2xml. Opět selektivně v závislosti na typu hodnoty a argumentech programu je zde vypisováno XML. U obou funkcí se jedná o vskutku změť podmínek, které tu a tam obsahují volání deklarující výpisy XML na výstup. </p>
<p>Tímto je popsána celá aplikace json2xml. Celé řešení v kódu jazyka Perl má jen o málo méně než 200 řádků, za což patří díky hlavně modulům, které byly použity. Jedná se o malý důkaz užitečnosti a síly těchto modulů. Nechť je jejich autorům vysloven aspoň malý dík za velkou práci, jež odvedli.</p>


<h1>Implementace programu JSON2XML v jazyce Perl</h1>
<pre class="highlight perl"><span class="c1">#!/usr/bin/perl</span>
<span class="k">use</span> <span class="nv">strict</span><span class="p">;</span>

<span class="c1"># used modules</span>
<span class="k">use</span> <span class="nn">Data::</span><span class="nv">Dumper</span><span class="p">;</span> <span class="c1"># stringified perl data structures</span>
<span class="k">use</span> <span class="nn">JSON::</span><span class="nv">XS</span><span class="p">;</span>     <span class="c1"># JSON serialising/deserialising</span>
<span class="k">use</span> <span class="nn">XML::</span><span class="nv">Writer</span><span class="p">;</span>  <span class="c1"># writing XML documents</span>
<span class="k">use</span> <span class="nn">IO::</span><span class="nv">File</span><span class="p">;</span>     <span class="c1"># supply object methods for filehandles</span>

<span class="c1"># available options of this program</span>
<span class="k">my</span> <span class="nv">$n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>  <span class="c1"># not to generate XML header</span>
<span class="k">my</span> <span class="nv">$r</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">;</span> <span class="c1"># name of the root element to wrap result</span>
<span class="k">my</span> <span class="nv">$s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>  <span class="c1"># string transform</span>
<span class="k">my</span> <span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>  <span class="c1"># integer transform</span>
<span class="k">my</span> <span class="nv">$l</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>  <span class="c1"># literals transform</span>
<span class="k">my</span> <span class="nv">$e</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>  <span class="c1"># root array recovery</span>

<span class="k">my</span> <span class="nv">$infile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span> <span class="k">my</span> <span class="nv">$outfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">;</span> <span class="c1"># input and output filenames</span>

<span class="c1">#########################################################################</span>
<span class="c1"># start</span>
<span class="c1">#########################################################################</span>

<span class="nv">parseOpts</span><span class="p">(</span><span class="nv">@ARGV</span><span class="p">);</span> <span class="c1"># parsing program arguments</span>

<span class="c1"># file input</span>
<span class="k">my</span> <span class="nv">$jshash</span><span class="p">;</span> <span class="c1"># declare json hash reference</span>

<span class="nb">local</span> <span class="vg">$/</span><span class="o">=</span><span class="nb">undef</span><span class="p">;</span> <span class="c1"># unset $/ for whole file read at once</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$infile</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># reading from file</span>
    <span class="nb">open</span> <span class="nv">JSFILE</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="nv">$infile</span> <span class="ow">or</span> <span class="nb">die</span> <span class="nv">$infile</span><span class="o">.</span><span class="s">&#39;: problem with file!&#39;</span><span class="p">;</span>
    <span class="nv">$jshash</span> <span class="o">=</span> <span class="nn">JSON::</span><span class="nv">XS</span><span class="o">-&gt;</span><span class="k">new</span><span class="o">-&gt;</span><span class="nv">utf8</span><span class="o">-&gt;</span><span class="nv">decode</span><span class="p">(</span><span class="sr">&lt;JSFILE&gt;</span><span class="p">);</span> <span class="c1"># json parsing</span>
    <span class="nb">close</span> <span class="nv">JSFILE</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span> <span class="c1"># reading from STDIN</span>
  <span class="nv">$jshash</span> <span class="o">=</span> <span class="nn">JSON::</span><span class="nv">XS</span><span class="o">-&gt;</span><span class="k">new</span><span class="o">-&gt;</span><span class="nv">utf8</span><span class="o">-&gt;</span><span class="nv">decode</span><span class="p">(</span><span class="sr">&lt;STDIN&gt;</span><span class="p">);</span> <span class="c1"># json parsing</span>
<span class="p">}</span>
<span class="c1"># explicit check of input JSON and options</span>
<span class="nb">die</span><span class="p">(</span><span class="s">&quot;Invalid JSON input\n&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$jshash</span> <span class="ow">eq</span> <span class="s">&#39;ARRAY&#39;</span> <span class="ow">and</span> <span class="o">!</span><span class="p">(</span><span class="nv">$r</span> <span class="ow">and</span> <span class="nv">$e</span><span class="p">));</span>

<span class="c1"># set output handler</span>
<span class="k">my</span> <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$outfile</span> <span class="p">?</span> <span class="k">new</span> <span class="nn">IO::</span><span class="nv">File</span><span class="p">(</span><span class="s">&quot;&gt;$outfile&quot;</span><span class="p">)</span> <span class="p">:</span> <span class="sr">&lt;STDOUT&gt;</span><span class="p">;</span>
<span class="c1"># create xml writer</span>
<span class="k">my</span> <span class="nv">$writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nn">XML::</span><span class="nv">Writer</span><span class="p">(</span><span class="nv">OUTPUT</span> <span class="o">=&gt;</span> <span class="nv">$output</span><span class="p">,</span> <span class="nv">UNSAFE</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">);</span>

<span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">xmlDecl</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">)</span> <span class="k">unless</span> <span class="nv">$n</span><span class="p">;</span> <span class="c1"># xml header if such option</span>
<span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="nv">$r</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$r</span><span class="p">;</span> <span class="c1"># root element if such option</span>

<span class="nv">json2xml</span><span class="p">(</span><span class="nv">$jshash</span><span class="p">);</span> <span class="c1"># JSON2XML</span>

<span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="nv">$r</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$r</span><span class="p">;</span> <span class="c1"># end root element if such option</span>

<span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">end</span><span class="p">();</span> <span class="c1"># destroy xml writer</span>
<span class="nv">$output</span><span class="o">-&gt;</span><span class="nb">close</span><span class="p">()</span> <span class="k">if</span> <span class="nv">$outfile</span><span class="p">;</span> <span class="c1"># close file if opened</span>

<span class="c1">#########################################################################</span>
<span class="c1"># finish</span>
<span class="c1">#########################################################################</span>


<span class="c1">##########################################################################</span>
<span class="c1"># subroutine for transforming JSON::XS hash into XML text</span>
<span class="k">sub </span><span class="nf">json2xml</span> <span class="p">{</span>
  <span class="k">my</span> <span class="p">(</span><span class="nv">$jr</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$jr</span> <span class="ow">eq</span> <span class="s">&#39;ARRAY&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="s">&#39;array&#39;</span><span class="p">);</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">@$jr</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># loop items in array</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="nb">ref</span> <span class="nv">$_</span> <span class="ow">eq</span> <span class="s">&#39;JSON::XS::Boolean&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># value</span>
          <span class="nv">value2xml</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">);</span> <span class="c1"># use &#39;item&#39; as a key</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="c1"># reference</span>
          <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">);</span>
          <span class="nv">json2xml</span><span class="p">(</span><span class="nv">$_</span><span class="p">);</span> <span class="c1"># recursive call for each item</span>
          <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="s">&#39;item&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="s">&#39;array&#39;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">#value2xml(&#39;item&#39;, $jr) if (ref $jr eq &#39;&#39;);</span>
  <span class="k">while</span> <span class="p">(</span> <span class="k">my</span> <span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="o">=</span> <span class="nb">each</span> <span class="p">(</span><span class="nv">%$jr</span><span class="p">)</span> <span class="p">)</span>
  <span class="p">{</span> <span class="c1"># main loop of writing XML</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$value</span> <span class="ow">eq</span> <span class="s">&#39;HASH&#39;</span><span class="p">)</span>
    <span class="p">{</span> <span class="c1"># HASH</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
      <span class="nv">json2xml</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span> <span class="c1"># recursive call for this hash</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$value</span> <span class="ow">eq</span> <span class="s">&#39;ARRAY&#39;</span><span class="p">)</span>
    <span class="p">{</span> <span class="c1"># ARRAY</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
      <span class="nv">json2xml</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span> <span class="c1"># process it at the begin of next call</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span> <span class="c1"># VALUE</span>
      <span class="nv">value2xml</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="c1"># end of WHILE</span>
<span class="p">}</span> <span class="c1"># end of json2xml</span>


<span class="c1">##########################################################################</span>
<span class="c1"># subroutine for transforming value into XML text</span>
<span class="k">sub </span><span class="nf">value2xml</span> <span class="p">{</span>
  <span class="k">my</span> <span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
  <span class="c1"># BOOLEAN LITERAL</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">ref</span> <span class="nv">$value</span> <span class="ow">eq</span> <span class="s">&#39;JSON::XS::Boolean&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nv">$l</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># make attribute</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">emptyTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span><span class="s">&#39;value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">?</span> <span class="s">&#39;true&#39;</span><span class="p">:</span><span class="s">&#39;false&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1"># make element</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">emptyTag</span><span class="p">(</span><span class="nv">$value</span> <span class="p">?</span> <span class="s">&#39;true&#39;</span><span class="p">:</span><span class="s">&#39;false&#39;</span><span class="p">);</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1"># NULL</span>
  <span class="k">elsif</span> <span class="p">(</span><span class="o">!</span> <span class="nb">defined</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nv">$l</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># make attribute</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">emptyTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="s">&#39;value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span> <span class="p">?</span> <span class="nv">$value</span> <span class="p">:</span> <span class="s">&#39;null&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1"># make element</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">emptyTag</span><span class="p">(</span><span class="s">&#39;null&#39;</span><span class="p">);</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1"># STRING or NUMERIC value</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$novalue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">Dumper</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=~</span> <span class="sr">/^.*= &#39;.*&#39;.*/</span>
    <span class="ow">or</span>  <span class="nv">Dumper</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="o">=~</span> <span class="sr">/^.*= &quot;.*&quot;.*/</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># true if string</span>
      <span class="nv">$novalue</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nv">$s</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1"># true if number</span>
      <span class="nv">$novalue</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nv">$novalue</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># make attribute</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">emptyTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span><span class="s">&#39;value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1"># make element</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">startTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">characters</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
      <span class="nv">$writer</span><span class="o">-&gt;</span><span class="nv">endTag</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">##########################################################################</span>
<span class="c1"># parsing of program arguments subroutine</span>
<span class="k">sub </span><span class="nf">parseOpts</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">$astr</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="nv">@_</span><span class="p">);</span> <span class="c1"># join all arguments into one string</span>
  <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">/^\s*$/</span><span class="p">);</span> <span class="c1"># ERROR - no arguments</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/--help//</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">die</span><span class="p">(</span><span class="s">&quot;--help must be only given argument\n&quot;</span><span class="p">)</span> <span class="k">unless</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">/^\s*$/</span><span class="p">);</span>
    <span class="nv">help</span><span class="p">();</span> <span class="c1"># print help message and exit</span>
    <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span> <span class="c1"># parse arguments</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/--input=([\S]*)//</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$infile</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
      <span class="nb">die</span><span class="p">(</span><span class="s">&quot;this input file cannot be used\n&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="nv">d</span> <span class="nv">$infile</span><span class="p">);</span>
      <span class="nb">die</span><span class="p">(</span><span class="s">&quot;input file not exists\n&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="o">-</span><span class="nv">f</span> <span class="nv">$infile</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/--output=([\S]*)//</span><span class="p">)</span> <span class="p">{</span>
      <span class="nv">$outfile</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
      <span class="nb">die</span><span class="p">(</span><span class="s">&quot;this output file cannot be used\n&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="nv">d</span> <span class="nv">$outfile</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">/^\s*$/</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># OPTIONS given</span>
      <span class="nv">$n</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/[\-]n//</span><span class="p">);</span>
      <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/[\-]r=([\S]*)//</span><span class="p">);</span>
      <span class="nv">$s</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/[\-]s//</span><span class="p">);</span>
      <span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/[\-]i//</span><span class="p">);</span>
      <span class="nv">$l</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/[\-]l//</span><span class="p">);</span>
      <span class="nv">$e</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">s/[\-]e//</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">die</span><span class="p">(</span><span class="s">&quot;-e can not be without -r.\nSee json2xml.pl --help\n&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$e</span> <span class="ow">and</span> <span class="o">!</span><span class="nv">$r</span><span class="p">);</span>
    <span class="nb">die</span><span class="p">(</span><span class="s">&quot;Wrong arguments are given\n&quot;</span><span class="p">)</span> <span class="k">unless</span> <span class="p">(</span><span class="nv">$astr</span> <span class="o">=~</span> <span class="sr">/^\s*$/</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1"># end of parseOpts</span>


<span class="c1">##########################################################################</span>
<span class="c1"># HELP PRINT subroutine</span>
<span class="k">sub </span><span class="nf">help</span> <span class="p">{</span>
    <span class="k">print</span> <span class="s">&quot;Program json2xml\n\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;Usage: jsn.pl [OPTIONS]\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;\nAvailable options:\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;\n--input=file1.ext\tInput JSON file\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;--output=file2.ext\tName of output XML file\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;-n\t\t\tNot to generate XML header\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;-r=root-element\t\tName of the element to wrap result\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;-s\t\t\tTransform strings to element instead attribute\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;-i\t\t\tTransform integers to element instead attribute\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;-l\t\t\tTransform other JSON literals to element\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;-e\t\t\tWrong root array recovery\n&quot;</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;\nOther controls:\n--help\t\t\tThis message\n\n&quot;</span><span class="p">;</span>
<span class="p">}</span> <span class="c1"># end of help</span>

<span class="c1"># end of script json2xml</span>
</pre>
<footer></footer>
</article>
</div>
</section>
<aside class='large-3 columns' id='sidebar-right'>
<div class='inn'>
<h1 class='teead'>
<a href='http://tricka.trikoko.cz/' title='Největší databáze prodejných triček'>
Největší
<br>
výběr
<br>
triček
</a>
</h1>
<div id='tees'></div>
<script src="https://raw.githubusercontent.com/BorisMoore/jsrender/master/jsrender.min.js"></script>
<script id="tshirt" type="text/x-jsrender">
  <li class="item">
    <a href="http://tricka.trikoko.cz/t/{{>id}}" title="{{>name}}" target="_blank">
      <img width="240" height="310" src="{{>imgurl}}" alt="{{>name}}" />
      <i class="">{{>label}}</i>
      <b class="price success label">{{>price}} Kč</b>
      <p style="display:none">{{>about}}</p>
    </a>
  </li>
</script>
<script>
  $.ajax({
       type: "GET",
       url: 'http://tricka.trikoko.cz/sample?take=3',
       dataType: 'json',
       success: function(data) {
              $('#tees').html( $('#tshirt').render(data) );
       }
  });
</script>


</div>
</aside>
</section>
<footer class='row' id='footer'>
<section class='tac large-2 columns'>
<h4>
<small>Analytika webu</small>
</h4>
<a href="http://www.toplist.cz/"><img src="http://toplist.cz/count.asp?id=1626242&logo=bc" border="0" alt="TOPlist" width="88" height="120" /></a>
</section>
<section class='tac large-4 columns'></section>
<section class='tac large-3 columns'>
<br>
Licence:
<img src="http://i.creativecommons.org/l/by/3.0/cz/80x15.png" />
<br>
<a href="https://github.com/fanda/ifanda.cz">Zdrojové kódy stránek</a>
<br>
<pre>pull request
pro článek sem</pre>
</section>
<section class='large-3 columns'>
<a href="http://www.webarchiv.cz/files/vydavatele/certifikat.html" onclick="return !window.open(this, 'kod', 'toolbar=no, menubar=no, directories=no, resizable=yes, status=no, width=600, height=210, top=200, left=50')"><img title="STRÁNKY ARCHIVOVÁNY NÁRODNÍ KNIHOVNOU ČR" style="border:none" oncontextmenu="return false" src="http://www.webarchiv.cz/images/ikona4.jpg"></a>
</section>
</footer>

</div>
</body>
</html>

